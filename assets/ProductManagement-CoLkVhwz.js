import{u as ae,a as re}from"./usePagination-Inn4IY3B.js";import{u as ne}from"./useCrud-CEQkmIa7.js";import{r as _,z as ie,s as q,h as b,k as de,p as ue,c as y,a as v,d as l,w as o,j as i,e as r,t as se,x as P,v as me,b as V,F as k,o as m,g as c,l as h}from"./index-CjIOrfGk.js";const pe={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ce={class:"order-1 sm:order-2 text-center"},fe={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 order-3"},ge={class:"overflow-auto"},Ve={__name:"ProductManagement",setup(_e){const{dialogWidth:L}=ae(),C=["全部商品","木吉他","電吉他","音箱","配件","吉他弦"],U=C.slice(1),f=_("全部商品"),Y=_(),a=ie({visible:!1,isEdit:!1,title:"",form:{createdAt:"",name:"",category:"",price:0,quantity:0}}),z={createdAt:[{required:!0,message:"請選擇進貨日期",trigger:"blur"}],name:[{required:!0,message:"請輸入商品名稱",trigger:"blur"}],category:[{required:!0,message:"請選擇商品分類",trigger:"blur"}],price:[{required:!0,message:"請輸入商品價格",trigger:"blur"}],quantity:[{required:!0,message:"請輸入商品數量",trigger:"blur"}]},{loading:j,dialogLoading:B,list:N,fetchData:$,handleAdd:E,handleEdit:F,handleDelete:S,submit:T}=ne({getApi:b.getProductList,addApi:b.addProduct,updateApi:b.updateProduct,deleteApi:b.deleteProduct,formRef:Y,dialog:a,defaultForm:{createdAt:q().format("YYYY-MM-DD"),name:"",category:"",price:0,quantity:0},getTitle:n=>n==="add"?"新增商品":"編輯商品"}),u=_(""),g=_(""),w=de(()=>{let n=N.value;if(f.value!=="全部商品"&&(n=n.filter(e=>e.category===f.value)),g.value.trim()){const e=g.value.toLowerCase();n=n.filter(d=>d.name.toLowerCase().includes(e))}return u.value&&(n=n.filter(e=>e.createdAt&&e.createdAt.startsWith(u.value))),n}),{currentPage:W,pageSize:R,pagedList:I,handlePageChange:O}=re(w,8),G=(n,e,d)=>q(d).format("YYYY-MM-DD"),H=n=>"NT$ "+n.price.toLocaleString();return ue(()=>{$()}),(n,e)=>{const d=r("el-button"),x=r("el-date-picker"),M=r("el-input"),J=r("el-tab-pane"),s=r("el-table-column"),K=r("el-table"),Q=r("el-pagination"),X=r("el-tabs"),p=r("el-form-item"),Z=r("el-option"),ee=r("el-select"),A=r("el-input-number"),te=r("el-form"),le=r("el-dialog"),D=me("loading");return m(),y(k,null,[v("header",pe,[l(d,{onClick:i(E),type:"primary",class:"order-2 sm:order-1"},{default:o(()=>e[10]||(e[10]=[c("新增商品")])),_:1,__:[10]},8,["onClick"]),v("h3",ce,se(u.value?u.value+" 進貨":"全部")+"庫存",1),v("div",fe,[l(x,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份"},null,8,["modelValue"]),l(M,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),"prefix-icon":"search",placeholder:"請輸入商品名稱"},null,8,["modelValue"])])]),v("div",ge,[P((m(),V(X,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),type:"border-card",class:"mb-4 min-w-[900px]","element-loading-text":"載入中，請稍候..."},{default:o(()=>[(m(),y(k,null,h(C,t=>l(J,{key:t,label:t,name:t},null,8,["label","name"])),64)),l(K,{data:i(I),class:"mb-4",stripe:""},{default:o(()=>[l(s,{prop:"createdAt",label:"進貨日期","min-width":"90",formatter:G}),l(s,{prop:"name",label:"商品名稱","min-width":"150"}),l(s,{prop:"category",label:"分類","min-width":"70"}),l(s,{prop:"price",label:"價格",sortable:"",formatter:H}),l(s,{prop:"quantity",label:"數量","min-width":"50"}),l(s,{label:"操作","min-width":"100"},{default:o(({row:t})=>[l(d,{onClick:oe=>i(F)(t),type:"primary"},{default:o(()=>e[11]||(e[11]=[c("編輯")])),_:2,__:[11]},1032,["onClick"]),l(d,{onClick:oe=>i(S)(t.id),type:"danger"},{default:o(()=>e[12]||(e[12]=[c("刪除")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(Q,{background:"",layout:"prev, pager, next","page-size":i(R),"current-page":i(W),total:w.value.length,onCurrentChange:i(O)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1},8,["modelValue"])),[[D,i(j)]])]),l(le,{modelValue:a.visible,"onUpdate:modelValue":e[9]||(e[9]=t=>a.visible=t),title:a.title,width:i(L)},{footer:o(()=>[l(d,{onClick:e[8]||(e[8]=t=>a.visible=!1)},{default:o(()=>e[13]||(e[13]=[c("取消")])),_:1,__:[13]}),l(d,{onClick:i(T),type:"primary"},{default:o(()=>e[14]||(e[14]=[c("確認")])),_:1,__:[14]},8,["onClick"])]),default:o(()=>[P((m(),V(te,{model:a.form,rules:z,ref_key:"formRef",ref:Y,"label-width":"80px","label-position":"right","element-loading-text":"載入中，請稍候..."},{default:o(()=>[l(p,{prop:"createdAt",label:"進貨日期"},{default:o(()=>[l(x,{modelValue:a.form.createdAt,"onUpdate:modelValue":e[3]||(e[3]=t=>a.form.createdAt=t),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),l(p,{prop:"name",label:"商品名稱"},{default:o(()=>[l(M,{modelValue:a.form.name,"onUpdate:modelValue":e[4]||(e[4]=t=>a.form.name=t)},null,8,["modelValue"])]),_:1}),l(p,{prop:"category",label:"分類"},{default:o(()=>[l(ee,{modelValue:a.form.category,"onUpdate:modelValue":e[5]||(e[5]=t=>a.form.category=t),placeholder:"請選擇分類"},{default:o(()=>[(m(!0),y(k,null,h(i(U),t=>(m(),V(Z,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{prop:"price",label:"價格"},{default:o(()=>[l(A,{modelValue:a.form.price,"onUpdate:modelValue":e[6]||(e[6]=t=>a.form.price=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),l(p,{prop:"quantity",label:"數量"},{default:o(()=>[l(A,{modelValue:a.form.quantity,"onUpdate:modelValue":e[7]||(e[7]=t=>a.form.quantity=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[D,i(B)]])]),_:1},8,["modelValue","title","width"])],64)}}};export{Ve as default};
