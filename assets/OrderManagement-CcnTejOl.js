import{u as ee,a as te}from"./usePagination-BZEvR8tY.js";import{u as le}from"./useCrud-HFyEL28M.js";import{_ as ae,r as b,z as oe,s as v,h as c,k as re,p as se,c as ne,a as Y,x as de,d as e,w as a,j as n,e as s,v as ue,b as ie,F as me,o as w,g as m,t as pe,E as x}from"./index-BIK9x_ai.js";const ce={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},fe={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ge={class:"overflow-auto"},_e={__name:"OrderManagement",setup(be){const{dialogWidth:k}=ee(),h=b(),o=oe({visible:!1,isEdit:!1,title:"",form:{createdAt:"",member:"",items:"",price:"",status:""}}),A={createdAt:[{required:!0,message:"請選擇下單日期",trigger:"blur"}],member:[{required:!0,message:"請輸入會員名稱",trigger:"blur"}],items:[{required:!0,message:"請輸入商品名稱",trigger:"blur"}],price:[{required:!0,message:"請輸入訂單金額",trigger:"blur"}],status:[{required:!0,message:"請選擇訂單狀態",trigger:"blur"}]},{loading:D,list:U,fetchData:L,handleAdd:O,handleEdit:N,handleDelete:S,submit:q}=le({getApi:c.getOrderList,addApi:c.addOrder,updateApi:c.updateOrder,deleteApi:c.deleteOrder,formRef:h,dialog:o,defaultForm:{createdAt:v().format("YYYY-MM-DD"),member:"",items:"",price:0,status:""},getTitle:r=>r==="add"?"新增訂單":"編輯訂單"}),z=async(r,t)=>{try{await c.updateOrder(r,{status:t}),x.success("更改訂單狀態成功")}catch{x.error("更改訂單狀態失敗")}},E=r=>{switch(r){case"processing":return"primary";case"shipped":return"warning";case"completed":return"success";default:return""}},T=r=>{switch(r){case"processing":return"處理中";case"shipped":return"已出貨";case"completed":return"已完成";default:return"未知"}},$=b(v().format("YYYY-MM")),f=b($.value),g=b(""),C=re(()=>U.value.filter(r=>{const t=!f.value||v(r.createdAt).format("YYYY-MM")===f.value,d=!g.value||r.orderNumber.toLowerCase().includes(g.value.toLowerCase());return t&&d})),{currentPage:j,pageSize:B,pagedList:P,handlePageChange:F}=te(C,8),I=(r,t,d)=>v(d).format("YYYY-MM-DD"),R=r=>"NT$ "+r.price.toLocaleString();return se(()=>{L()}),(r,t)=>{const d=s("el-button"),M=s("el-date-picker"),V=s("el-input"),u=s("el-table-column"),W=s("el-tag"),i=s("el-option"),y=s("el-select"),G=s("el-table"),H=s("el-pagination"),J=s("el-card"),p=s("el-form-item"),K=s("el-input-number"),Q=s("el-form"),X=s("el-dialog"),Z=ue("loading");return w(),ne(me,null,[Y("header",ce,[e(d,{onClick:n(O),type:"primary"},{default:a(()=>t[9]||(t[9]=[m("新增訂單")])),_:1},8,["onClick"]),Y("div",fe,[e(M,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=l=>f.value=l),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份"},null,8,["modelValue"]),e(V,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),"prefix-icon":"search",placeholder:"請輸入訂單編號"},null,8,["modelValue"])])]),de((w(),ie(J,{"element-loading-text":"載入中，請稍候..."},{default:a(()=>[Y("div",ge,[e(G,{data:n(P),class:"mb-4 min-w-[1000px]",stripe:""},{default:a(()=>[e(u,{prop:"orderNumber",label:"訂單編號","min-width":"120"}),e(u,{prop:"createdAt",label:"下單日期","min-width":"100",formatter:I}),e(u,{prop:"member",label:"會員名稱","min-width":"80"}),e(u,{prop:"items",label:"商品名稱","min-width":"180"}),e(u,{prop:"price",label:"訂單金額","min-width":"100",formatter:R}),e(u,{prop:"status",label:"狀態","min-width":"140"},{default:a(({row:l})=>[e(y,{modelValue:l.status,"onUpdate:modelValue":_=>l.status=_,onChange:_=>z(l.id,l.status),class:"status-select"},{prefix:a(()=>[e(W,{type:E(l.status)},{default:a(()=>[m(pe(T(l.status)),1)]),_:2},1032,["type"])]),default:a(()=>[e(i,{label:"處理中",value:"processing"}),e(i,{label:"已出貨",value:"shipped"}),e(i,{label:"已完成",value:"completed"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(u,{label:"操作","min-width":"150"},{default:a(({row:l})=>[e(d,{onClick:_=>n(N)(l),type:"primary"},{default:a(()=>t[10]||(t[10]=[m("編輯")])),_:2},1032,["onClick"]),e(d,{onClick:_=>n(S)(l.id),type:"danger"},{default:a(()=>t[11]||(t[11]=[m("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(H,{background:"",layout:"prev, pager, next","page-size":n(B),"current-page":n(j),total:C.value.length,onCurrentChange:n(F)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[Z,n(D)]]),e(X,{modelValue:o.visible,"onUpdate:modelValue":t[8]||(t[8]=l=>o.visible=l),title:o.title,width:n(k)},{footer:a(()=>[e(d,{onClick:t[7]||(t[7]=l=>o.visible=!1)},{default:a(()=>t[12]||(t[12]=[m("取消")])),_:1}),e(d,{onClick:n(q),type:"primary"},{default:a(()=>t[13]||(t[13]=[m("確認")])),_:1},8,["onClick"])]),default:a(()=>[e(Q,{model:o.form,rules:A,ref_key:"formRef",ref:h,"label-width":"80px","label-position":"right"},{default:a(()=>[e(p,{prop:"createdAt",label:"下單日期"},{default:a(()=>[e(M,{modelValue:o.form.createdAt,"onUpdate:modelValue":t[2]||(t[2]=l=>o.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"選擇日期"},null,8,["modelValue"])]),_:1}),e(p,{prop:"member",label:"會員名稱"},{default:a(()=>[e(V,{modelValue:o.form.member,"onUpdate:modelValue":t[3]||(t[3]=l=>o.form.member=l)},null,8,["modelValue"])]),_:1}),e(p,{prop:"items",label:"商品名稱"},{default:a(()=>[e(V,{modelValue:o.form.items,"onUpdate:modelValue":t[4]||(t[4]=l=>o.form.items=l)},null,8,["modelValue"])]),_:1}),e(p,{prop:"price",label:"訂單金額"},{default:a(()=>[e(K,{modelValue:o.form.price,"onUpdate:modelValue":t[5]||(t[5]=l=>o.form.price=l)},null,8,["modelValue"])]),_:1}),e(p,{prop:"status",label:"訂單狀態"},{default:a(()=>[e(y,{modelValue:o.form.status,"onUpdate:modelValue":t[6]||(t[6]=l=>o.form.status=l),placeholder:"請選擇訂單狀態"},{default:a(()=>[e(i,{label:"處理中",value:"processing"}),e(i,{label:"已出貨",value:"shipped"}),e(i,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])],64)}}},he=ae(_e,[["__scopeId","data-v-af5a1652"]]);export{he as default};
