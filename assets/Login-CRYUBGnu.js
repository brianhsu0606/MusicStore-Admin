import{_ as A,u as E,r as m,c as N,a as _,b as U,d as r,w as o,e as n,f as I,o as v,g,h as w,E as c}from"./index-CjIOrfGk.js";const z={class:"background flex justify-center items-center"},M={class:"auth-wrapper"},T={class:"flex gap-4 justify-center items-center mb-6"},D={__name:"Login",setup(G){const L=E(),C=I(),p=m(!1),y=()=>{p.value=!p.value},V=m(null),l=m({name:"",username:"",password:"",confirmPassword:""}),P={name:[{required:!0,message:"請輸入用戶名稱",trigger:"blur"},{min:3,max:10,message:"用戶名稱必須為 3 - 10 個字",trigger:"blur"}],username:[{required:!0,message:"請輸入帳號",trigger:"blur"},{min:5,max:20,message:"帳號必須為 5 - 20 個字",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:5,max:20,message:"密碼必須為 5 - 20 個字",trigger:"blur"}],confirmPassword:[{required:!0,message:"請再次輸入密碼",trigger:"blur"},{validator:(t,e,f)=>{e!==l.value.password?f(new Error("兩次輸入的密碼不一致")):f()},trigger:"blur"}]},u=m(!1),k=m(null),i=m({username:"",password:""}),q={username:[{required:!0,message:"請輸入帳號",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"}]},B=async()=>{try{await V.value.validate(),u.value=!0,await w.register(l.value),p.value=!1,c.success("註冊成功")}catch(t){if(typeof t=="object")return;c.error(t)}finally{u.value=!1}},F=async()=>{try{await k.value.validate(),u.value=!0;const t=await w.login(i.value);localStorage.setItem("token",t);const e=await w.getProfile();L.setUser(e),c.success("登入成功！"),C.push("/home")}catch(t){if(typeof t=="object")return;c.error(t)}finally{u.value=!1}};return(t,e)=>{const f=n("ShoppingBag"),h=n("el-icon"),d=n("el-input"),s=n("el-form-item"),b=n("el-button"),S=n("ArrowLeft"),x=n("el-link"),R=n("el-form"),j=n("ArrowRight");return v(),N("div",z,[_("div",M,[_("header",T,[r(h,{size:"30"},{default:o(()=>[r(f)]),_:1}),e[6]||(e[6]=_("h2",null,"樂器行後台系統",-1))]),p.value?(v(),U(R,{key:0,ref_key:"registerFormRef",ref:V,model:l.value,rules:P},{default:o(()=>[r(s,{prop:"name"},{default:o(()=>[r(d,{modelValue:l.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.name=a),"prefix-icon":"Postcard",placeholder:"請輸入用戶名稱"},null,8,["modelValue"])]),_:1}),r(s,{prop:"username"},{default:o(()=>[r(d,{modelValue:l.value.username,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.username=a),"prefix-icon":"User",placeholder:"請輸入帳號"},null,8,["modelValue"])]),_:1}),r(s,{prop:"password"},{default:o(()=>[r(d,{modelValue:l.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.password=a),"prefix-icon":"Lock",type:"password",placeholder:"請輸入密碼"},null,8,["modelValue"])]),_:1}),r(s,{prop:"confirmPassword"},{default:o(()=>[r(d,{modelValue:l.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.confirmPassword=a),"prefix-icon":"Lock",type:"password",placeholder:"確認密碼"},null,8,["modelValue"])]),_:1}),r(s,null,{default:o(()=>[r(b,{type:"primary",onClick:B,loading:u.value},{default:o(()=>e[7]||(e[7]=[g("註冊")])),_:1,__:[7]},8,["loading"])]),_:1}),r(s,null,{default:o(()=>[r(x,{onClick:y},{default:o(()=>[r(S,{class:"w-4 mr-1"}),e[8]||(e[8]=g("登入"))]),_:1,__:[8]})]),_:1})]),_:1},8,["model"])):(v(),U(R,{key:1,ref_key:"loginFormRef",ref:k,model:i.value,rules:q},{default:o(()=>[r(s,{prop:"username"},{default:o(()=>[r(d,{modelValue:i.value.username,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.username=a),"prefix-icon":"User",placeholder:"請輸入帳號"},null,8,["modelValue"])]),_:1}),r(s,{prop:"password"},{default:o(()=>[r(d,{modelValue:i.value.password,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.password=a),"prefix-icon":"Lock",type:"password",placeholder:"請輸入密碼"},null,8,["modelValue"])]),_:1}),r(s,null,{default:o(()=>[r(b,{type:"primary",onClick:F,loading:u.value},{default:o(()=>e[9]||(e[9]=[g("登入")])),_:1,__:[9]},8,["loading"])]),_:1}),r(s,null,{default:o(()=>[r(x,{onClick:y},{default:o(()=>[r(j,{class:"w-4 mr-1"}),e[10]||(e[10]=g("註冊帳號"))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"]))])])}}},J=A(D,[["__scopeId","data-v-91460e9b"]]);export{J as default};
