import{u as O,a as Q}from"./usePagination-BOaze3gY.js";import{u as X}from"./useCrud-DQNCJ6PL.js";import{r as _,z as Z,s as b,h as v,k as ee,p as te,c as le,a as Y,x as ae,d as t,w as a,j as m,e as n,t as w,v as oe,b as re,F as ne,o as C,g as f}from"./index-BrJsWRuD.js";const de={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},me={class:"order-1 sm:order2 text-center"},se={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 order-3"},ie={class:"overflow-auto"},ge={__name:"MemberManagement",setup(ue){const{dialogWidth:k}=O(),V=_(),r=Z({visible:!1,isEdit:!1,title:"",form:{createdAt:"",name:"",gender:"",birth:"",addr:""}}),x={createdAt:[{required:!0,message:"請選擇註冊日期",trigger:"blur"}],name:[{required:!0,message:"請輸入姓名",trigger:"blur"}],gender:[{required:!0,message:"請選擇性別",trigger:"blur"}]},{loading:y,list:A,fetchData:U,handleAdd:L,handleEdit:z,handleDelete:F,submit:j}=X({getApi:v.getMemberList,addApi:v.addMember,updateApi:v.updateMember,deleteApi:v.deleteMember,formRef:V,dialog:r,defaultForm:{createdAt:b().format("YYYY-MM-DD"),name:"",gender:"",birth:"",addr:""},getTitle:d=>d==="add"?"新增會員":"編輯會員"}),B=d=>{const e=new Date,o=new Date(d);let u=e.getFullYear()-o.getFullYear();const p=e.getMonth()-o.getMonth();return d?((p<0||p===0&&e.getDate()<o.getDate())&&u--,u):"-"},E=_(b().format("YYYY-MM")),i=_(E.value),g=_(""),h=ee(()=>A.value.filter(d=>{const e=!i.value||b(d.createdAt).format("YYYY-MM")===i.value,o=!g.value||d.name.toLowerCase().includes(g.value.toLowerCase());return e&&o})),{currentPage:q,pageSize:I,pagedList:N,handlePageChange:P}=Q(h,8),D=(d,e,o)=>o?b(o).format("YYYY-MM-DD"):"-",S=(d,e,o)=>o||"-";return te(()=>{U()}),(d,e)=>{const o=n("el-button"),u=n("el-date-picker"),p=n("el-input"),s=n("el-table-column"),$=n("el-table"),R=n("el-pagination"),T=n("el-card"),c=n("el-form-item"),M=n("el-radio"),W=n("el-radio-group"),G=n("el-form"),H=n("el-dialog"),J=oe("loading");return C(),le(ne,null,[Y("header",de,[t(o,{type:"primary",onClick:m(L),class:"order-2 sm:order-1"},{default:a(()=>e[9]||(e[9]=[f("新增會員")])),_:1},8,["onClick"]),Y("h3",me,w(i.value?i.value+" ":"全部")+"新增會員",1),Y("div",se,[t(u,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),type:"month",format:"YYYY-MM","value-format":"YYYY-MM",size:"large",placeholder:"請選擇月份"},null,8,["modelValue"]),t(p,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),"prefix-icon":"search",placeholder:"請輸入會員名稱"},null,8,["modelValue"])])]),ae((C(),re(T,{"element-loading-text":"載入中，請稍候..."},{default:a(()=>[Y("div",ie,[t($,{data:m(N),class:"mb-4 min-w-[900px]",stripe:""},{default:a(()=>[t(s,{prop:"memberId",label:"會員ID","min-width":"66"}),t(s,{prop:"createdAt",label:"註冊日期",formatter:D}),t(s,{prop:"name",label:"姓名"}),t(s,{prop:"gender",label:"性別","min-width":"60"}),t(s,{label:"年齡","min-width":"60"},{default:a(({row:l})=>[f(w(B(l.birth)),1)]),_:1}),t(s,{prop:"birth",label:"生日",formatter:D}),t(s,{prop:"addr",label:"地址",formatter:S}),t(s,{label:"操作","min-width":"100"},{default:a(({row:l})=>[t(o,{type:"primary",onClick:K=>m(z)(l)},{default:a(()=>e[10]||(e[10]=[f("編輯")])),_:2},1032,["onClick"]),t(o,{type:"danger",onClick:K=>m(F)(l.id)},{default:a(()=>e[11]||(e[11]=[f("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(R,{background:"",layout:"prev, pager, next","page-size":m(I),"current-page":m(q),total:h.value.length,onCurrentChange:m(P)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[J,m(y)]]),t(H,{modelValue:r.visible,"onUpdate:modelValue":e[8]||(e[8]=l=>r.visible=l),title:r.title,width:m(k)},{footer:a(()=>[t(o,{onClick:e[7]||(e[7]=l=>r.visible=!1)},{default:a(()=>e[12]||(e[12]=[f("取消")])),_:1}),t(o,{onClick:m(j),type:"primary"},{default:a(()=>e[13]||(e[13]=[f("確認")])),_:1},8,["onClick"])]),default:a(()=>[t(G,{model:r.form,rules:x,ref_key:"formRef",ref:V,"label-width":"80px","label-position":"right"},{default:a(()=>[t(c,{prop:"createdAt",label:"註冊日期"},{default:a(()=>[t(u,{modelValue:r.form.createdAt,"onUpdate:modelValue":e[2]||(e[2]=l=>r.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(c,{prop:"name",label:"姓名"},{default:a(()=>[t(p,{modelValue:r.form.name,"onUpdate:modelValue":e[3]||(e[3]=l=>r.form.name=l)},null,8,["modelValue"])]),_:1}),t(c,{prop:"gender",label:"性別"},{default:a(()=>[t(W,{modelValue:r.form.gender,"onUpdate:modelValue":e[4]||(e[4]=l=>r.form.gender=l),placeholder:"請選擇性別"},{default:a(()=>[t(M,{label:"男",value:"男"}),t(M,{label:"女",value:"女"}),t(M,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"生日"},{default:a(()=>[t(u,{modelValue:r.form.birth,"onUpdate:modelValue":e[5]||(e[5]=l=>r.form.birth=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(c,{label:"地址"},{default:a(()=>[t(p,{modelValue:r.form.addr,"onUpdate:modelValue":e[6]||(e[6]=l=>r.form.addr=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])],64)}}};export{ge as default};
