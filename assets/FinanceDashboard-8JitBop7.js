import{u as we,a as E}from"./usePagination-7tDWkq96.js";import{u as O}from"./useCrud-ImgxaMOx.js";import{_ as De,r as D,z as Ae,s as m,h as b,k as d,p as ke,c as A,a as u,d as e,F as k,l as W,e as r,w as l,v as Ve,o as g,b as h,y as Le,n as ze,t as x,x as V,j as n,g as Y}from"./index-CoyXvUyw.js";const Pe={class:"flex flex-col sm:flex-row justify-between gap-4 mb-4"},Se={class:"flex flex-col sm:flex-row order-2 sm:order-1 gap-4"},Re={class:"flex gap-4 items-center"},$e={class:"overflow-auto"},Ne={class:"overflow-auto"},Fe={class:"flex justify-between items-center mb-2 min-w-[800px]"},Te={class:"mb-2"},Ue={class:"overflow-auto"},je={class:"mb-2"},Be={class:"overflow-auto"},qe={__name:"FinanceDashboard",setup(Ee){const{dialogWidth:G}=we(),L=D(),s=Ae({visible:!1,isEdit:!1,title:"",form:{name:"",category:"",createdAt:"",price:0}}),I={name:[{required:!0,message:"請輸入成本名稱",trigger:"blur"}],category:[{required:!0,message:"請選擇成本分類",trigger:"blur"}],createdAt:[{required:!0,message:"請選擇成本日期",trigger:"blur"}],price:[{required:!0,message:"請輸入成本金額",trigger:"blur"}]},H=["租金/水電","人事成本","進貨成本","其他成本"],{loading:J,dialogLoading:K,list:z,fetchData:Q,handleAdd:X,handleEdit:Z,handleDelete:ee,submit:te}=O({getApi:b.getCostList,addApi:b.addCost,updateApi:b.updateCost,deleteApi:b.deleteCost,formRef:L,dialog:s,defaultForm:{name:"",category:"",createdAt:m().format("YYYY-MM-DD"),price:0},getTitle:a=>a==="add"?"新增成本":"編輯成本"}),{loading:ae,list:P,fetchData:le}=O({getApi:b.getRevenueList}),S=d(()=>P.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value).reduce((a,t)=>a+t.price,0)),R=d(()=>z.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value).reduce((a,t)=>a+t.price,0)),oe=d(()=>S.value-R.value),re=D(m().format("YYYY-MM")),i=D(re.value),y=d(()=>z.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value)),M=d(()=>P.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value)),{currentPage:ne,pageSize:se,pagedList:ie,handlePageChange:ue}=E(y,8,!1),{currentPage:de,pageSize:ce,pagedList:pe,handlePageChange:me}=E(M,8,!1),ge=d(()=>{const a={};return y.value.forEach(t=>{const p=t.category||"未分類";a[p]=(a[p]||0)+t.price}),Object.entries(a).map(([t,p])=>({name:t,value:p}))}),fe=d(()=>({title:{text:`${i.value} 成本佔比圖`},tooltip:{},legend:{top:"bottom"},series:[{name:"成本項目",type:"pie",radius:"50%",data:ge.value}]})),$=d(()=>[...M.value].sort((a,t)=>new Date(a.createdAt)-new Date(t.createdAt))),_e=d(()=>({title:{text:`${i.value} 營業額趨勢圖`},tooltip:{},xAxis:{type:"category",data:$.value.map(a=>m(a.createdAt).format("YYYY-MM-DD")),axisLabel:{rotate:45}},yAxis:{type:"value"},series:[{name:"營業額",type:"line",data:$.value.map(a=>a.price)}]})),ve=d(()=>[{icon:"GoodsFilled",bg:"bg-blue-400",title:`${i.value} 成本：`,value:()=>"NT "+R.value.toLocaleString()},{icon:"Money",bg:"bg-green-400",title:`${i.value} 營業額：`,value:()=>"NT "+S.value.toLocaleString()},{icon:"SuccessFilled",bg:"bg-red-500",title:`${i.value} 淨利潤：`,value:()=>"NT "+oe.value.toLocaleString()}]),N=(a,t,p)=>m(p).format("YYYY-MM-DD"),F=a=>"NT "+Number(a.price).toLocaleString();return ke(()=>{Q(),le()}),(a,t)=>{const p=r("el-icon"),f=r("el-card"),T=r("el-date-picker"),U=r("v-chart"),_=r("el-button"),c=r("el-table-column"),j=r("el-table"),B=r("el-pagination"),be=r("el-input"),C=r("el-form-item"),he=r("el-option"),Ye=r("el-select"),Ce=r("el-input-number"),xe=r("el-form"),ye=r("el-dialog"),q=r("el-col"),Me=r("el-row"),w=Ve("loading");return g(),A(k,null,[u("header",Pe,[u("div",Se,[(g(!0),A(k,null,W(ve.value,(o,v)=>(g(),h(f,{key:v,class:"min-w-[300px]"},{default:l(()=>[u("div",Re,[e(p,{size:50,class:Le(`${o.bg} rounded-lg p-1`)},{default:l(()=>[(g(),h(ze(o.icon)))]),_:2},1032,["class"]),u("div",null,[u("h3",null,x(o.title),1),u("p",null,x(o.value()),1)])])]),_:2},1024))),128))]),e(T,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份",clearable:!1,style:{width:"200px",height:"42px","font-size":"18px"},class:"order-1 sm:order-2"},null,8,["modelValue"])]),e(Me,{gutter:20},{default:l(()=>[V((g(),h(q,{lg:24,xl:12,"element-loading-text":"載入中，請稍候..."},{default:l(()=>[e(f,{class:"mb-4"},{default:l(()=>[u("div",$e,[e(U,{option:fe.value,autoresize:"",class:"h-[400px] min-w-[300px]"},null,8,["option"])])]),_:1}),e(f,{class:"mb-4"},{default:l(()=>[u("div",Ne,[u("header",Fe,[u("h3",Te,x(i.value)+" 成本資料",1),e(_,{onClick:n(X),type:"primary"},{default:l(()=>t[7]||(t[7]=[Y("新增成本")])),_:1},8,["onClick"])]),e(j,{data:n(ie),stripe:"",class:"mb-4 min-w-[800px]"},{default:l(()=>[e(c,{prop:"createdAt",label:"日期",formatter:N}),e(c,{prop:"name",label:"項目"}),e(c,{prop:"category",label:"分類"}),e(c,{prop:"price",label:"金額",formatter:F,sortable:""}),e(c,{label:"操作"},{default:l(({row:o})=>[e(_,{onClick:v=>n(Z)(o),type:"primary"},{default:l(()=>t[8]||(t[8]=[Y("編輯")])),_:2},1032,["onClick"]),e(_,{onClick:v=>n(ee)(o.id),type:"danger"},{default:l(()=>t[9]||(t[9]=[Y("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(B,{background:"",layout:"prev, pager, next","page-size":n(se),"current-page":n(ne),total:y.value.length,onCurrentChange:n(ue)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1}),e(ye,{modelValue:s.visible,"onUpdate:modelValue":t[6]||(t[6]=o=>s.visible=o),title:s.title,width:n(G)},{footer:l(()=>[e(_,{onClick:t[5]||(t[5]=o=>s.visible=!1)},{default:l(()=>t[10]||(t[10]=[Y("取消")])),_:1}),e(_,{onClick:n(te),type:"primary"},{default:l(()=>t[11]||(t[11]=[Y("確認")])),_:1},8,["onClick"])]),default:l(()=>[V((g(),h(xe,{model:s.form,rules:I,ref_key:"formRef",ref:L,"label-width":"80px","label-position":"right","element-loading-text":"載入中，請稍候..."},{default:l(()=>[e(C,{prop:"name",label:"成本名稱"},{default:l(()=>[e(be,{modelValue:s.form.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.name=o)},null,8,["modelValue"])]),_:1}),e(C,{prop:"category",label:"成本分類"},{default:l(()=>[e(Ye,{modelValue:s.form.category,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.category=o),placeholder:"請選擇成本分類"},{default:l(()=>[(g(),A(k,null,W(H,(o,v)=>e(he,{key:v,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(C,{prop:"createdAt",label:"日期"},{default:l(()=>[e(T,{modelValue:s.form.createdAt,"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.createdAt=o),"value-format":"YYYY-MM-DD",placeholder:"選擇日期"},null,8,["modelValue"])]),_:1}),e(C,{prop:"price",label:"金額"},{default:l(()=>[e(Ce,{modelValue:s.form.price,"onUpdate:modelValue":t[4]||(t[4]=o=>s.form.price=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[w,n(K)]])]),_:1},8,["modelValue","title","width"])]),_:1})),[[w,n(J)]]),V((g(),h(q,{lg:24,xl:12,"element-loading-text":"載入中，請稍候..."},{default:l(()=>[e(f,{class:"mb-4"},{default:l(()=>[u("div",Ue,[e(U,{option:_e.value,autoresize:"",class:"h-[400px] min-w-[400px]"},null,8,["option"])])]),_:1}),e(f,{class:"mb-4"},{default:l(()=>[u("h3",je,x(i.value)+" 營業額資料",1),u("div",Be,[e(j,{data:n(pe),stripe:"",class:"mb-4 min-w-[900px]"},{default:l(()=>[e(c,{prop:"createdAt",label:"日期",formatter:N}),e(c,{prop:"price",label:"營業額",formatter:F,sortable:""}),e(c,{prop:"note",label:"備註"}),e(c,{prop:"createdBy",label:"登錄者"})]),_:1},8,["data"])]),e(B,{background:"",layout:"prev, pager, next","page-size":n(ce),"current-page":n(de),total:M.value.length,onCurrentChange:n(me)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})]),_:1})),[[w,n(ae)]])]),_:1})],64)}}},Ie=De(qe,[["__scopeId","data-v-88909fca"]]);export{Ie as default};
