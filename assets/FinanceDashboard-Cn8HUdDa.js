import{u as we,a as E}from"./usePagination-C7W2dMz0.js";import{u as O}from"./useCrud-CXCE9cWP.js";import{_ as De,r as D,z as Ae,s as m,h as b,k as d,p as Ve,c as A,a as u,d as e,F as V,l as W,e as r,w as a,v as ke,o as g,b as Y,y as Le,n as ze,t as y,x as k,j as n,g as h}from"./index-BW3yvak1.js";const Pe={class:"flex flex-col sm:flex-row justify-between gap-4 mb-4"},Se={class:"flex flex-col sm:flex-row order-2 sm:order-1 gap-4"},Re={class:"flex gap-4 items-center"},$e={class:"overflow-auto"},Ne={class:"overflow-auto"},Fe={class:"flex justify-between items-center mb-2 min-w-[800px]"},Te={class:"mb-2"},Ue={class:"overflow-auto"},je={class:"mb-2"},Be={class:"overflow-auto"},qe={__name:"FinanceDashboard",setup(Ee){const{dialogWidth:G}=we(),L=D(),s=Ae({visible:!1,isEdit:!1,title:"",form:{name:"",category:"",createdAt:"",price:0}}),I={name:[{required:!0,message:"請輸入成本名稱",trigger:"blur"}],category:[{required:!0,message:"請選擇成本分類",trigger:"blur"}],createdAt:[{required:!0,message:"請選擇成本日期",trigger:"blur"}],price:[{required:!0,message:"請輸入成本金額",trigger:"blur"}]},H=["租金/水電","人事成本","進貨成本","其他成本"],{loading:J,dialogLoading:K,list:z,fetchData:Q,handleAdd:X,handleEdit:Z,handleDelete:ee,submit:te}=O({getApi:b.getCostList,addApi:b.addCost,updateApi:b.updateCost,deleteApi:b.deleteCost,formRef:L,dialog:s,defaultForm:{name:"",category:"",createdAt:m().format("YYYY-MM-DD"),price:0},getTitle:l=>l==="add"?"新增成本":"編輯成本"}),{loading:ae,list:P,fetchData:le}=O({getApi:b.getRevenueList}),oe=D(m().format("YYYY-MM")),i=D(oe.value),C=d(()=>z.value.filter(l=>m(l.createdAt).format("YYYY-MM")===i.value)),M=d(()=>P.value.filter(l=>m(l.createdAt).format("YYYY-MM")===i.value)),{currentPage:re,pageSize:ne,pagedList:se,handlePageChange:ie}=E(C,8,!1),{currentPage:ue,pageSize:de,pagedList:ce,handlePageChange:pe}=E(M,8,!1),me=d(()=>{const l=C.value.reduce((t,c)=>(t[c.category]=(t[c.category]||0)+c.price,t),{});return Object.entries(l).map(([t,c])=>({name:t,value:c}))}),ge=d(()=>({title:{text:`${i.value} 成本佔比圖`},tooltip:{},legend:{top:"bottom"},series:[{name:"成本項目",type:"pie",radius:"50%",data:me.value}]})),S=d(()=>[...M.value].reverse()),_e=d(()=>({title:{text:`${i.value} 營業額趨勢圖`},tooltip:{},xAxis:{type:"category",data:S.value.map(l=>m(l.createdAt).format("YYYY-MM-DD")),axisLabel:{rotate:45}},yAxis:{type:"value"},series:[{name:"營業額",type:"line",data:S.value.map(l=>l.price)}]})),R=d(()=>P.value.filter(l=>m(l.createdAt).format("YYYY-MM")===i.value).reduce((l,t)=>l+t.price,0)),$=d(()=>z.value.filter(l=>m(l.createdAt).format("YYYY-MM")===i.value).reduce((l,t)=>l+t.price,0)),fe=d(()=>R.value-$.value),ve=d(()=>[{icon:"GoodsFilled",bg:"bg-blue-400",title:`${i.value} 成本：`,value:()=>"NT "+$.value.toLocaleString()},{icon:"Money",bg:"bg-green-400",title:`${i.value} 營業額：`,value:()=>"NT "+R.value.toLocaleString()},{icon:"SuccessFilled",bg:"bg-red-500",title:`${i.value} 淨利潤：`,value:()=>"NT "+fe.value.toLocaleString()}]),N=(l,t,c)=>m(c).format("YYYY-MM-DD"),F=l=>"NT "+Number(l.price).toLocaleString();return Ve(()=>{Q(),le()}),(l,t)=>{const c=r("el-icon"),_=r("el-card"),T=r("el-date-picker"),U=r("v-chart"),f=r("el-button"),p=r("el-table-column"),j=r("el-table"),B=r("el-pagination"),be=r("el-input"),x=r("el-form-item"),Ye=r("el-option"),he=r("el-select"),xe=r("el-input-number"),ye=r("el-form"),Ce=r("el-dialog"),q=r("el-col"),Me=r("el-row"),w=ke("loading");return g(),A(V,null,[u("header",Pe,[u("div",Se,[(g(!0),A(V,null,W(ve.value,(o,v)=>(g(),Y(_,{key:v,class:"min-w-[300px]"},{default:a(()=>[u("div",Re,[e(c,{size:50,class:Le(`${o.bg} rounded-lg p-1`)},{default:a(()=>[(g(),Y(ze(o.icon)))]),_:2},1032,["class"]),u("div",null,[u("h3",null,y(o.title),1),u("p",null,y(o.value()),1)])])]),_:2},1024))),128))]),e(T,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份",clearable:!1,style:{width:"200px",height:"42px","font-size":"18px"},class:"order-1 sm:order-2"},null,8,["modelValue"])]),e(Me,{gutter:20},{default:a(()=>[k((g(),Y(q,{lg:24,xl:12,"element-loading-text":"載入中，請稍候..."},{default:a(()=>[e(_,{class:"mb-4"},{default:a(()=>[u("div",$e,[e(U,{option:ge.value,autoresize:"",class:"h-[400px] min-w-[300px]"},null,8,["option"])])]),_:1}),e(_,{class:"mb-4"},{default:a(()=>[u("div",Ne,[u("header",Fe,[u("h3",Te,y(i.value)+" 成本資料",1),e(f,{onClick:n(X),type:"primary"},{default:a(()=>t[7]||(t[7]=[h("新增成本")])),_:1,__:[7]},8,["onClick"])]),e(j,{data:n(se),stripe:"",class:"mb-4 min-w-[800px]"},{default:a(()=>[e(p,{prop:"createdAt",label:"日期",formatter:N}),e(p,{prop:"name",label:"項目"}),e(p,{prop:"category",label:"分類"}),e(p,{prop:"price",label:"金額",formatter:F,sortable:""}),e(p,{label:"操作"},{default:a(({row:o})=>[e(f,{onClick:v=>n(Z)(o),type:"primary"},{default:a(()=>t[8]||(t[8]=[h("編輯")])),_:2,__:[8]},1032,["onClick"]),e(f,{onClick:v=>n(ee)(o.id),type:"danger"},{default:a(()=>t[9]||(t[9]=[h("刪除")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(B,{background:"",layout:"prev, pager, next","page-size":n(ne),"current-page":n(re),total:C.value.length,onCurrentChange:n(ie)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1}),e(Ce,{modelValue:s.visible,"onUpdate:modelValue":t[6]||(t[6]=o=>s.visible=o),title:s.title,width:n(G)},{footer:a(()=>[e(f,{onClick:t[5]||(t[5]=o=>s.visible=!1)},{default:a(()=>t[10]||(t[10]=[h("取消")])),_:1,__:[10]}),e(f,{onClick:n(te),type:"primary"},{default:a(()=>t[11]||(t[11]=[h("確認")])),_:1,__:[11]},8,["onClick"])]),default:a(()=>[k((g(),Y(ye,{model:s.form,rules:I,ref_key:"formRef",ref:L,"label-width":"80px","label-position":"right","element-loading-text":"載入中，請稍候..."},{default:a(()=>[e(x,{prop:"name",label:"成本名稱"},{default:a(()=>[e(be,{modelValue:s.form.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.name=o)},null,8,["modelValue"])]),_:1}),e(x,{prop:"category",label:"成本分類"},{default:a(()=>[e(he,{modelValue:s.form.category,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.category=o),placeholder:"請選擇成本分類"},{default:a(()=>[(g(),A(V,null,W(H,(o,v)=>e(Ye,{key:v,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(x,{prop:"createdAt",label:"日期"},{default:a(()=>[e(T,{modelValue:s.form.createdAt,"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.createdAt=o),"value-format":"YYYY-MM-DD",placeholder:"選擇日期"},null,8,["modelValue"])]),_:1}),e(x,{prop:"price",label:"金額"},{default:a(()=>[e(xe,{modelValue:s.form.price,"onUpdate:modelValue":t[4]||(t[4]=o=>s.form.price=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[w,n(K)]])]),_:1},8,["modelValue","title","width"])]),_:1})),[[w,n(J)]]),k((g(),Y(q,{lg:24,xl:12,"element-loading-text":"載入中，請稍候..."},{default:a(()=>[e(_,{class:"mb-4"},{default:a(()=>[u("div",Ue,[e(U,{option:_e.value,autoresize:"",class:"h-[400px] min-w-[400px]"},null,8,["option"])])]),_:1}),e(_,{class:"mb-4"},{default:a(()=>[u("h3",je,y(i.value)+" 營業額資料",1),u("div",Be,[e(j,{data:n(ce),stripe:"",class:"mb-4 min-w-[900px]"},{default:a(()=>[e(p,{prop:"createdAt",label:"日期",formatter:N}),e(p,{prop:"price",label:"營業額",formatter:F,sortable:""}),e(p,{prop:"note",label:"備註"}),e(p,{prop:"createdBy",label:"登錄者"})]),_:1},8,["data"])]),e(B,{background:"",layout:"prev, pager, next","page-size":n(de),"current-page":n(ue),total:M.value.length,onCurrentChange:n(pe)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})]),_:1})),[[w,n(ae)]])]),_:1})],64)}}},Ie=De(qe,[["__scopeId","data-v-4a133dae"]]);export{Ie as default};
