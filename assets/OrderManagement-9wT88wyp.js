import{u as oe,a as re}from"./usePagination-GoRTJrxl.js";import{u as se}from"./useCrud-DOQhBH-I.js";import{_ as ne,r as b,z as de,s as v,h as f,k as ie,p as ue,c as me,a as V,x as k,d as e,w as a,j as n,e as s,t as A,v as pe,b as D,F as ce,o as h,g as p,E as U}from"./index-D45sH2sE.js";const fe={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ge={class:"order-1 sm:order2 text-center"},_e={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 order-3"},be={class:"overflow-auto"},ve={__name:"OrderManagement",setup(Ve){const{dialogWidth:L}=oe(),C=b(),o=de({visible:!1,isEdit:!1,title:"",form:{createdAt:"",member:"",items:"",price:"",status:""}}),O={createdAt:[{required:!0,message:"請選擇下單日期",trigger:"blur"}],member:[{required:!0,message:"請輸入會員名稱",trigger:"blur"}],items:[{required:!0,message:"請輸入商品名稱",trigger:"blur"}],price:[{required:!0,message:"請輸入訂單金額",trigger:"blur"}],status:[{required:!0,message:"請選擇訂單狀態",trigger:"blur"}]},{loading:N,dialogLoading:S,list:q,fetchData:z,handleAdd:E,handleEdit:T,handleDelete:$,submit:j}=se({getApi:f.getOrderList,addApi:f.addOrder,updateApi:f.updateOrder,deleteApi:f.deleteOrder,formRef:C,dialog:o,defaultForm:{createdAt:v().format("YYYY-MM-DD"),member:"",items:"",price:0,status:""},getTitle:r=>r==="add"?"新增訂單":"編輯訂單"}),B=async(r,t)=>{try{await f.updateOrder(r,{status:t}),U.success("更改訂單狀態成功")}catch{U.error("更改訂單狀態失敗")}},P=r=>{switch(r){case"processing":return"primary";case"shipped":return"warning";case"completed":return"success";default:return""}},F=r=>{switch(r){case"processing":return"處理中";case"shipped":return"已出貨";case"completed":return"已完成";default:return"未知"}},I=b(v().format("YYYY-MM")),u=b(I.value),g=b(""),M=ie(()=>q.value.filter(r=>{const t=!u.value||v(r.createdAt).format("YYYY-MM")===u.value,d=!g.value||r.orderNumber.toLowerCase().includes(g.value.toLowerCase());return t&&d})),{currentPage:R,pageSize:W,pagedList:G,handlePageChange:H}=re(M,8),J=(r,t,d)=>v(d).format("YYYY-MM-DD"),K=r=>"NT$ "+r.price.toLocaleString();return ue(()=>{z()}),(r,t)=>{const d=s("el-button"),x=s("el-date-picker"),Y=s("el-input"),i=s("el-table-column"),Q=s("el-tag"),m=s("el-option"),y=s("el-select"),X=s("el-table"),Z=s("el-pagination"),ee=s("el-card"),c=s("el-form-item"),te=s("el-input-number"),le=s("el-form"),ae=s("el-dialog"),w=pe("loading");return h(),me(ce,null,[V("header",fe,[e(d,{onClick:n(E),type:"primary",class:"order-2 sm:order-1"},{default:a(()=>t[9]||(t[9]=[p("新增訂單")])),_:1},8,["onClick"]),V("h3",ge,A(u.value?u.value+" ":"全部")+"訂單",1),V("div",_e,[e(x,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份"},null,8,["modelValue"]),e(Y,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),"prefix-icon":"search",placeholder:"請輸入訂單編號"},null,8,["modelValue"])])]),k((h(),D(ee,{"element-loading-text":"載入中，請稍候..."},{default:a(()=>[V("div",be,[e(X,{data:n(G),class:"mb-4 min-w-[1000px]",stripe:""},{default:a(()=>[e(i,{prop:"orderNumber",label:"訂單編號","min-width":"120"}),e(i,{prop:"createdAt",label:"下單日期","min-width":"100",formatter:J}),e(i,{prop:"member",label:"會員名稱","min-width":"80"}),e(i,{prop:"items",label:"商品名稱","min-width":"180"}),e(i,{prop:"price",label:"訂單金額","min-width":"100",formatter:K}),e(i,{prop:"status",label:"狀態","min-width":"140"},{default:a(({row:l})=>[e(y,{modelValue:l.status,"onUpdate:modelValue":_=>l.status=_,onChange:_=>B(l.id,l.status),class:"status-select"},{prefix:a(()=>[e(Q,{type:P(l.status)},{default:a(()=>[p(A(F(l.status)),1)]),_:2},1032,["type"])]),default:a(()=>[e(m,{label:"處理中",value:"processing"}),e(m,{label:"已出貨",value:"shipped"}),e(m,{label:"已完成",value:"completed"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(i,{label:"操作","min-width":"150"},{default:a(({row:l})=>[e(d,{onClick:_=>n(T)(l),type:"primary"},{default:a(()=>t[10]||(t[10]=[p("編輯")])),_:2},1032,["onClick"]),e(d,{onClick:_=>n($)(l.id),type:"danger"},{default:a(()=>t[11]||(t[11]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(Z,{background:"",layout:"prev, pager, next","page-size":n(W),"current-page":n(R),total:M.value.length,onCurrentChange:n(H)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[w,n(N)]]),e(ae,{modelValue:o.visible,"onUpdate:modelValue":t[8]||(t[8]=l=>o.visible=l),title:o.title,width:n(L)},{footer:a(()=>[e(d,{onClick:t[7]||(t[7]=l=>o.visible=!1)},{default:a(()=>t[12]||(t[12]=[p("取消")])),_:1}),e(d,{onClick:n(j),type:"primary"},{default:a(()=>t[13]||(t[13]=[p("確認")])),_:1},8,["onClick"])]),default:a(()=>[k((h(),D(le,{model:o.form,rules:O,ref_key:"formRef",ref:C,"label-width":"80px","label-position":"right","element-loading-text":"載入中，請稍候..."},{default:a(()=>[e(c,{prop:"createdAt",label:"下單日期"},{default:a(()=>[e(x,{modelValue:o.form.createdAt,"onUpdate:modelValue":t[2]||(t[2]=l=>o.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"選擇日期"},null,8,["modelValue"])]),_:1}),e(c,{prop:"member",label:"會員名稱"},{default:a(()=>[e(Y,{modelValue:o.form.member,"onUpdate:modelValue":t[3]||(t[3]=l=>o.form.member=l)},null,8,["modelValue"])]),_:1}),e(c,{prop:"items",label:"商品名稱"},{default:a(()=>[e(Y,{modelValue:o.form.items,"onUpdate:modelValue":t[4]||(t[4]=l=>o.form.items=l)},null,8,["modelValue"])]),_:1}),e(c,{prop:"price",label:"訂單金額"},{default:a(()=>[e(te,{modelValue:o.form.price,"onUpdate:modelValue":t[5]||(t[5]=l=>o.form.price=l)},null,8,["modelValue"])]),_:1}),e(c,{prop:"status",label:"訂單狀態"},{default:a(()=>[e(y,{modelValue:o.form.status,"onUpdate:modelValue":t[6]||(t[6]=l=>o.form.status=l),placeholder:"請選擇訂單狀態"},{default:a(()=>[e(m,{label:"處理中",value:"processing"}),e(m,{label:"已出貨",value:"shipped"}),e(m,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[w,n(S)]])]),_:1},8,["modelValue","title","width"])],64)}}},Me=ne(ve,[["__scopeId","data-v-008bd341"]]);export{Me as default};
