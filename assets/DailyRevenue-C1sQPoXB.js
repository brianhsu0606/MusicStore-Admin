import{u as O,r as _,z as Q,s as c,h as f,k as X,p as Z,c as ee,a as g,x as C,d as t,w as o,j as r,e as n,t as te,v as le,b as M,F as oe,o as b,g as u}from"./index-BW3yvak1.js";import{u as ae,a as re}from"./usePagination-C7W2dMz0.js";import{u as ne}from"./useCrud-CXCE9cWP.js";const de={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ie={class:"order-1 sm:order-2 text-center"},se={class:"overflow-auto"},fe={__name:"DailyRevenue",setup(ue){const x=O(),{dialogWidth:D}=ae(),v=_(),a=Q({visible:!1,isEdit:!1,title:"",form:{createdAt:"",price:0,note:"",createdBy:""}}),A={createdAt:[{required:!0,message:"請選擇日期",trigger:"blur"}],price:[{required:!0,message:"請輸入營業額",trigger:"blur"}],createdBy:[{required:!0,message:"請輸入登錄者",trigger:"blur"}]},{loading:B,dialogLoading:w,list:R,fetchData:U,handleAdd:L,handleEdit:z,handleDelete:S,submit:h}=ne({getApi:f.getRevenueList,addApi:f.addRevenue,updateApi:f.updateRevenue,deleteApi:f.deleteRevenue,formRef:v,dialog:a,defaultForm:{createdAt:c().format("YYYY-MM-DD"),price:0,note:"",createdBy:x.name},getTitle:d=>d==="add"?"新增營業額":"編輯營業額"}),N=_(c().format("YYYY-MM")),m=_(N.value),Y=X(()=>R.value.filter(d=>c(d.createdAt).format("YYYY-MM")===m.value)),{currentPage:P,pageSize:$,pagedList:j,handlePageChange:q}=re(Y,8),E=(d,e,i)=>c(i).format("YYYY-MM-DD"),F=d=>"NT$ "+d.price.toLocaleString();return Z(()=>{U()}),(d,e)=>{const i=n("el-button"),y=n("el-date-picker"),s=n("el-table-column"),T=n("el-table"),W=n("el-pagination"),G=n("el-card"),p=n("el-form-item"),H=n("el-input-number"),V=n("el-input"),I=n("el-form"),J=n("el-dialog"),k=le("loading");return b(),ee(oe,null,[g("header",de,[t(i,{onClick:r(L),type:"primary",class:"order-2 sm:order-1"},{default:o(()=>e[7]||(e[7]=[u("新增營業額")])),_:1,__:[7]},8,["onClick"]),g("h3",ie,te(m.value)+" 營業額",1),t(y,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",clearable:!1,class:"order-3"},null,8,["modelValue"])]),C((b(),M(G,{"element-loading-text":"載入中，請稍候..."},{default:o(()=>[g("div",se,[t(T,{data:r(j),class:"mb-4 min-w-[800px]",stripe:""},{default:o(()=>[t(s,{prop:"createdAt",label:"日期",formatter:E}),t(s,{prop:"price",label:"營業額",formatter:F}),t(s,{prop:"note",label:"備註"}),t(s,{prop:"createdBy",label:"登錄者"}),t(s,{label:"操作"},{default:o(({row:l})=>[t(i,{onClick:K=>r(z)(l),type:"primary"},{default:o(()=>e[8]||(e[8]=[u("編輯")])),_:2,__:[8]},1032,["onClick"]),t(i,{onClick:K=>r(S)(l.id),type:"danger"},{default:o(()=>e[9]||(e[9]=[u("刪除")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(W,{background:"",layout:"prev, pager, next","page-size":r($),"current-page":r(P),total:Y.value.length,onCurrentChange:r(q)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[k,r(B)]]),t(J,{modelValue:a.visible,"onUpdate:modelValue":e[6]||(e[6]=l=>a.visible=l),title:a.title,width:r(D)},{footer:o(()=>[t(i,{onClick:e[5]||(e[5]=l=>a.visible=!1)},{default:o(()=>e[10]||(e[10]=[u("取消")])),_:1,__:[10]}),t(i,{onClick:r(h),type:"primary"},{default:o(()=>e[11]||(e[11]=[u("確認")])),_:1,__:[11]},8,["onClick"])]),default:o(()=>[C((b(),M(I,{model:a.form,rules:A,ref_key:"formRef",ref:v,"label-width":"80px","label-position":"right","element-loading-text":"載入中，請稍候..."},{default:o(()=>[t(p,{prop:"createdAt",label:"選擇日期"},{default:o(()=>[t(y,{modelValue:a.form.createdAt,"onUpdate:modelValue":e[1]||(e[1]=l=>a.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(p,{prop:"price",label:"營業額"},{default:o(()=>[t(H,{modelValue:a.form.price,"onUpdate:modelValue":e[2]||(e[2]=l=>a.form.price=l)},null,8,["modelValue"])]),_:1}),t(p,{label:"備註"},{default:o(()=>[t(V,{modelValue:a.form.note,"onUpdate:modelValue":e[3]||(e[3]=l=>a.form.note=l),type:"textarea"},null,8,["modelValue"])]),_:1}),t(p,{prop:"createdBy",label:"登錄者"},{default:o(()=>[t(V,{modelValue:a.form.createdBy,"onUpdate:modelValue":e[4]||(e[4]=l=>a.form.createdBy=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[k,r(w)]])]),_:1},8,["modelValue","title","width"])],64)}}};export{fe as default};
