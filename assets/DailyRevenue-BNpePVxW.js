import{u as I,r as g,z as J,s as p,h as f,k as K,p as O,c as Q,a as y,x as X,d as t,w as o,j as n,e as r,v as Z,b as ee,F as te,o as V,g as u}from"./index-Cde80ToV.js";import{u as le,a as oe}from"./usePagination-DEJfOGIJ.js";import{u as ae}from"./useCrud-DZA7qJ6E.js";const re={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ne={class:"overflow-auto"},me={__name:"DailyRevenue",setup(de){const k=I(),{dialogWidth:C}=le(),_=g(),a=J({visible:!1,isEdit:!1,title:"",form:{createdAt:"",price:0,note:"",createdBy:""}}),M={createdAt:[{required:!0,message:"請選擇日期",trigger:"blur"}],price:[{required:!0,message:"請輸入營業額",trigger:"blur"}],createdBy:[{required:!0,message:"請輸入登錄者",trigger:"blur"}]},{loading:x,list:A,fetchData:D,handleAdd:B,handleEdit:w,handleDelete:R,submit:U}=ae({getApi:f.getRevenueList,addApi:f.addRevenue,updateApi:f.updateRevenue,deleteApi:f.deleteRevenue,formRef:_,dialog:a,defaultForm:{createdAt:p().format("YYYY-MM-DD"),price:0,note:"",createdBy:k.name},getTitle:d=>d==="add"?"新增營業額":"編輯營業額"}),z=g(p().format("YYYY-MM")),c=g(z.value),b=K(()=>A.value.filter(d=>p(d.createdAt).format("YYYY-MM")===c.value)),{currentPage:L,pageSize:N,pagedList:P,handlePageChange:S}=oe(b,8),$=(d,e,i)=>p(i).format("YYYY-MM-DD"),j=d=>"NT$ "+d.price.toLocaleString();return O(()=>{D()}),(d,e)=>{const i=r("el-button"),v=r("el-date-picker"),s=r("el-table-column"),q=r("el-table"),E=r("el-pagination"),F=r("el-card"),m=r("el-form-item"),T=r("el-input-number"),Y=r("el-input"),h=r("el-form"),W=r("el-dialog"),G=Z("loading");return V(),Q(te,null,[y("header",re,[t(i,{onClick:n(B),type:"primary"},{default:o(()=>e[7]||(e[7]=[u("新增營業額")])),_:1},8,["onClick"]),t(v,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",clearable:!1},null,8,["modelValue"])]),X((V(),ee(F,{"element-loading-text":"載入中，請稍候..."},{default:o(()=>[y("div",ne,[t(q,{data:n(P),class:"mb-4 min-w-[800px]",stripe:""},{default:o(()=>[t(s,{prop:"createdAt",label:"日期",formatter:$}),t(s,{prop:"price",label:"營業額",formatter:j}),t(s,{prop:"note",label:"備註"}),t(s,{prop:"createdBy",label:"登錄者"}),t(s,{label:"操作"},{default:o(({row:l})=>[t(i,{onClick:H=>n(w)(l),type:"primary"},{default:o(()=>e[8]||(e[8]=[u("編輯")])),_:2},1032,["onClick"]),t(i,{onClick:H=>n(R)(l.id),type:"danger"},{default:o(()=>e[9]||(e[9]=[u("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(E,{background:"",layout:"prev, pager, next","page-size":n(N),"current-page":n(L),total:b.value.length,onCurrentChange:n(S)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[G,n(x)]]),t(W,{modelValue:a.visible,"onUpdate:modelValue":e[6]||(e[6]=l=>a.visible=l),title:a.title,class:"responsive-dialog",width:n(C)},{footer:o(()=>[t(i,{onClick:e[5]||(e[5]=l=>a.visible=!1)},{default:o(()=>e[10]||(e[10]=[u("取消")])),_:1}),t(i,{onClick:n(U),type:"primary"},{default:o(()=>e[11]||(e[11]=[u("確認")])),_:1},8,["onClick"])]),default:o(()=>[t(h,{model:a.form,rules:M,ref_key:"formRef",ref:_,"label-width":"80px","label-position":"right"},{default:o(()=>[t(m,{prop:"createdAt",label:"選擇日期"},{default:o(()=>[t(v,{modelValue:a.form.createdAt,"onUpdate:modelValue":e[1]||(e[1]=l=>a.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(m,{prop:"price",label:"營業額"},{default:o(()=>[t(T,{modelValue:a.form.price,"onUpdate:modelValue":e[2]||(e[2]=l=>a.form.price=l)},null,8,["modelValue"])]),_:1}),t(m,{label:"備註"},{default:o(()=>[t(Y,{modelValue:a.form.note,"onUpdate:modelValue":e[3]||(e[3]=l=>a.form.note=l),type:"textarea"},null,8,["modelValue"])]),_:1}),t(m,{prop:"createdBy",label:"登錄者"},{default:o(()=>[t(Y,{modelValue:a.form.createdBy,"onUpdate:modelValue":e[4]||(e[4]=l=>a.form.createdBy=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])],64)}}};export{me as default};
