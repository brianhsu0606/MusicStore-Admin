import{u as le,a as oe}from"./usePagination-BlbGfASI.js";import{u as ae}from"./useCrud-k8ZUbDpW.js";import{r as _,z as re,s as A,h as b,k as ne,p as ie,c as y,a as v,d as l,w as o,j as i,e as r,t as de,x as ue,v as se,b as D,F as V,o as p,g as c,l as q}from"./index-CXv7L5KJ.js";const me={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},pe={class:"order-1 sm:order-2 text-center"},ce={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 order-3"},fe={class:"overflow-auto"},ye={__name:"ProductManagement",setup(ge){const{dialogWidth:P}=le(),k=["全部商品","木吉他","電吉他","音箱","配件","吉他弦"],h=k.slice(1),f=_("全部商品"),C=_(),a=re({visible:!1,isEdit:!1,title:"",form:{createdAt:"",name:"",category:"",price:0,quantity:0}}),U={createdAt:[{required:!0,message:"請選擇進貨日期",trigger:"blur"}],name:[{required:!0,message:"請輸入商品名稱",trigger:"blur"}],category:[{required:!0,message:"請選擇商品分類",trigger:"blur"}],price:[{required:!0,message:"請輸入商品價格",trigger:"blur"}],quantity:[{required:!0,message:"請輸入商品數量",trigger:"blur"}]},{loading:L,list:z,fetchData:j,handleAdd:B,handleEdit:N,handleDelete:$,submit:E}=ae({getApi:b.getProductList,addApi:b.addProduct,updateApi:b.updateProduct,deleteApi:b.deleteProduct,formRef:C,dialog:a,defaultForm:{createdAt:A().format("YYYY-MM-DD"),name:"",category:"",price:0,quantity:0},getTitle:n=>n==="add"?"新增商品":"編輯商品"}),u=_(""),g=_(""),Y=ne(()=>{let n=z.value;if(f.value!=="全部商品"&&(n=n.filter(e=>e.category===f.value)),g.value.trim()){const e=g.value.toLowerCase();n=n.filter(d=>d.name.toLowerCase().includes(e))}return u.value&&(n=n.filter(e=>e.createdAt&&e.createdAt.startsWith(u.value))),n}),{currentPage:F,pageSize:S,pagedList:T,handlePageChange:W}=oe(Y,8),R=(n,e,d)=>A(d).format("YYYY-MM-DD"),I=n=>"NT$ "+n.price.toLocaleString();return ie(()=>{j()}),(n,e)=>{const d=r("el-button"),w=r("el-date-picker"),x=r("el-input"),O=r("el-tab-pane"),s=r("el-table-column"),G=r("el-table"),H=r("el-pagination"),J=r("el-tabs"),m=r("el-form-item"),K=r("el-option"),Q=r("el-select"),M=r("el-input-number"),X=r("el-form"),Z=r("el-dialog"),ee=se("loading");return p(),y(V,null,[v("header",me,[l(d,{onClick:i(B),type:"primary",class:"order-2 sm:order-1"},{default:o(()=>e[10]||(e[10]=[c("新增商品")])),_:1},8,["onClick"]),v("h3",pe,de(u.value?u.value+" 進貨":"全部")+"庫存",1),v("div",ce,[l(w,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份"},null,8,["modelValue"]),l(x,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),"prefix-icon":"search",placeholder:"請輸入商品名稱"},null,8,["modelValue"])])]),v("div",fe,[ue((p(),D(J,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),type:"border-card",class:"mb-4 min-w-[900px]","element-loading-text":"載入中，請稍候..."},{default:o(()=>[(p(),y(V,null,q(k,t=>l(O,{key:t,label:t,name:t},null,8,["label","name"])),64)),l(G,{data:i(T),class:"mb-4",stripe:""},{default:o(()=>[l(s,{prop:"createdAt",label:"進貨日期","min-width":"90",formatter:R}),l(s,{prop:"name",label:"商品名稱","min-width":"150"}),l(s,{prop:"category",label:"分類","min-width":"70"}),l(s,{prop:"price",label:"價格",sortable:"",formatter:I}),l(s,{prop:"quantity",label:"數量","min-width":"50"}),l(s,{label:"操作","min-width":"100"},{default:o(({row:t})=>[l(d,{onClick:te=>i(N)(t),type:"primary"},{default:o(()=>e[11]||(e[11]=[c("編輯")])),_:2},1032,["onClick"]),l(d,{onClick:te=>i($)(t.id),type:"danger"},{default:o(()=>e[12]||(e[12]=[c("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(H,{background:"",layout:"prev, pager, next","page-size":i(S),"current-page":i(F),total:Y.value.length,onCurrentChange:i(W)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1},8,["modelValue"])),[[ee,i(L)]])]),l(Z,{modelValue:a.visible,"onUpdate:modelValue":e[9]||(e[9]=t=>a.visible=t),title:a.title,width:i(P)},{footer:o(()=>[l(d,{onClick:e[8]||(e[8]=t=>a.visible=!1)},{default:o(()=>e[13]||(e[13]=[c("取消")])),_:1}),l(d,{onClick:i(E),type:"primary"},{default:o(()=>e[14]||(e[14]=[c("確認")])),_:1},8,["onClick"])]),default:o(()=>[l(X,{model:a.form,rules:U,ref_key:"formRef",ref:C,"label-width":"80px","label-position":"right"},{default:o(()=>[l(m,{prop:"createdAt",label:"進貨日期"},{default:o(()=>[l(w,{modelValue:a.form.createdAt,"onUpdate:modelValue":e[3]||(e[3]=t=>a.form.createdAt=t),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),l(m,{prop:"name",label:"商品名稱"},{default:o(()=>[l(x,{modelValue:a.form.name,"onUpdate:modelValue":e[4]||(e[4]=t=>a.form.name=t)},null,8,["modelValue"])]),_:1}),l(m,{prop:"category",label:"分類"},{default:o(()=>[l(Q,{modelValue:a.form.category,"onUpdate:modelValue":e[5]||(e[5]=t=>a.form.category=t),placeholder:"請選擇分類"},{default:o(()=>[(p(!0),y(V,null,q(i(h),t=>(p(),D(K,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{prop:"price",label:"價格"},{default:o(()=>[l(M,{modelValue:a.form.price,"onUpdate:modelValue":e[6]||(e[6]=t=>a.form.price=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),l(m,{prop:"quantity",label:"數量"},{default:o(()=>[l(M,{modelValue:a.form.quantity,"onUpdate:modelValue":e[7]||(e[7]=t=>a.form.quantity=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])],64)}}};export{ye as default};
