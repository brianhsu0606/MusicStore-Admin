import{r as f,E as r,C as y}from"./index-BW3yvak1.js";const B=({getApi:o,addApi:v,updateApi:h,deleteApi:m,formRef:l,dialog:t,defaultForm:w,getTitle:d})=>{const n=f(!1),i=f(!1),s=f([]),u=(e,a="操作失敗")=>{r.error(typeof e=="string"?e:a)};return{loading:n,dialogLoading:i,list:s,fetchData:async()=>{n.value=!0;try{s.value=await o()}catch(e){u(e,"資料載入失敗")}finally{n.value=!1}},handleAdd:()=>{var e;t.visible=!0,t.isEdit=!1,t.title=d("add"),Object.assign(t.form,{...w}),(e=l.value)==null||e.clearValidate()},handleEdit:e=>{var a;t.visible=!0,t.isEdit=!0,t.title=d("edit"),Object.assign(t.form,e),(a=l.value)==null||a.clearValidate()},handleDelete:async e=>{if(await y.confirm("確定要刪除嗎？","刪除確認",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{n.value=!0,await m(e),s.value=s.value.filter(c=>c.id!==e),r.success("刪除成功")}catch(c){u(c,"刪除失敗")}finally{n.value=!1}},submit:async()=>{try{if(await l.value.validate(),i.value=!0,t.isEdit){const e=await h(t.form.id,t.form),a=s.value.findIndex(c=>c.id===e.id);a!==-1&&s.value.splice(a,1,e),r.success("編輯成功")}else{const e=await v(t.form);s.value.unshift(e),r.success("新增成功")}s.value.sort((e,a)=>new Date(a.createdAt)-new Date(e.createdAt)),t.visible=!1}catch(e){const a=t.isEdit?"編輯失敗":"新增失敗";u(e,a)}finally{i.value=!1}}}};export{B as u};
