import{u as K,a as O}from"./usePagination-bN7CoV3G.js";import{u as Q}from"./useCrud-BkOA_Nqx.js";import{r as _,z as X,s as b,h as Y,k as Z,p as ee,c as te,a as M,x as le,d as t,w as a,j as m,e as n,v as ae,b as oe,F as re,o as C,g as p,t as ne}from"./index-dfya9NE1.js";const de={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},me={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ie={class:"overflow-auto"},ge={__name:"MemberManagement",setup(se){const{dialogWidth:w}=K(),V=_(),r=X({visible:!1,isEdit:!1,title:"",form:{createdAt:"",name:"",gender:"",birth:"",addr:""}}),k={createdAt:[{required:!0,message:"請選擇註冊日期",trigger:"blur"}],name:[{required:!0,message:"請輸入姓名",trigger:"blur"}],gender:[{required:!0,message:"請選擇性別",trigger:"blur"}]},{loading:x,list:y,fetchData:A,handleAdd:U,handleEdit:L,handleDelete:z,submit:F}=Q({getApi:Y.getMemberList,addApi:Y.addMember,updateApi:Y.updateMember,deleteApi:Y.deleteMember,formRef:V,dialog:r,defaultForm:{createdAt:b().format("YYYY-MM-DD"),name:"",gender:"",birth:"",addr:""},getTitle:d=>d==="add"?"新增會員":"編輯會員"}),j=d=>{const e=new Date,o=new Date(d);let s=e.getFullYear()-o.getFullYear();const u=e.getMonth()-o.getMonth();return d?((u<0||u===0&&e.getDate()<o.getDate())&&s--,s):"-"},B=_(b().format("YYYY-MM")),g=_(B.value),c=_(""),h=Z(()=>y.value.filter(d=>{const e=!g.value||b(d.createdAt).format("YYYY-MM")===g.value,o=!c.value||d.name.toLowerCase().includes(c.value.toLowerCase());return e&&o})),{currentPage:E,pageSize:q,pagedList:N,handlePageChange:P}=O(h,8),D=(d,e,o)=>o?b(o).format("YYYY-MM-DD"):"-",S=(d,e,o)=>o||"-";return ee(()=>{A()}),(d,e)=>{const o=n("el-button"),s=n("el-date-picker"),u=n("el-input"),i=n("el-table-column"),$=n("el-table"),R=n("el-pagination"),T=n("el-card"),f=n("el-form-item"),v=n("el-radio"),W=n("el-radio-group"),I=n("el-form"),G=n("el-dialog"),H=ae("loading");return C(),te(re,null,[M("header",de,[t(o,{type:"primary",onClick:m(U)},{default:a(()=>e[9]||(e[9]=[p("新增會員")])),_:1},8,["onClick"]),M("div",me,[t(s,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),type:"month",format:"YYYY-MM","value-format":"YYYY-MM",size:"large",placeholder:"請選擇月份"},null,8,["modelValue"]),t(u,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value=l),"prefix-icon":"search",placeholder:"請輸入會員名稱"},null,8,["modelValue"])])]),le((C(),oe(T,{"element-loading-text":"載入中，請稍候..."},{default:a(()=>[M("div",ie,[t($,{data:m(N),class:"mb-4 min-w-[900px]",stripe:""},{default:a(()=>[t(i,{prop:"createdAt",label:"註冊日期",formatter:D}),t(i,{prop:"name",label:"姓名"}),t(i,{prop:"gender",label:"性別","min-width":"60"}),t(i,{label:"年齡","min-width":"60"},{default:a(({row:l})=>[p(ne(j(l.birth)),1)]),_:1}),t(i,{prop:"birth",label:"生日",formatter:D}),t(i,{prop:"addr",label:"地址",formatter:S}),t(i,{label:"操作","min-width":"100"},{default:a(({row:l})=>[t(o,{type:"primary",onClick:J=>m(L)(l)},{default:a(()=>e[10]||(e[10]=[p("編輯")])),_:2},1032,["onClick"]),t(o,{type:"danger",onClick:J=>m(z)(l.id)},{default:a(()=>e[11]||(e[11]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(R,{background:"",layout:"prev, pager, next","page-size":m(q),"current-page":m(E),total:h.value.length,onCurrentChange:m(P)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[H,m(x)]]),t(G,{modelValue:r.visible,"onUpdate:modelValue":e[8]||(e[8]=l=>r.visible=l),title:r.title,width:m(w)},{footer:a(()=>[t(o,{onClick:e[7]||(e[7]=l=>r.visible=!1)},{default:a(()=>e[12]||(e[12]=[p("取消")])),_:1}),t(o,{onClick:m(F),type:"primary"},{default:a(()=>e[13]||(e[13]=[p("確認")])),_:1},8,["onClick"])]),default:a(()=>[t(I,{model:r.form,rules:k,ref_key:"formRef",ref:V,"label-width":"80px","label-position":"right"},{default:a(()=>[t(f,{prop:"createdAt",label:"註冊日期"},{default:a(()=>[t(s,{modelValue:r.form.createdAt,"onUpdate:modelValue":e[2]||(e[2]=l=>r.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(f,{prop:"name",label:"姓名"},{default:a(()=>[t(u,{modelValue:r.form.name,"onUpdate:modelValue":e[3]||(e[3]=l=>r.form.name=l)},null,8,["modelValue"])]),_:1}),t(f,{prop:"gender",label:"性別"},{default:a(()=>[t(W,{modelValue:r.form.gender,"onUpdate:modelValue":e[4]||(e[4]=l=>r.form.gender=l),placeholder:"請選擇性別"},{default:a(()=>[t(v,{label:"男",value:"男"}),t(v,{label:"女",value:"女"}),t(v,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"生日"},{default:a(()=>[t(s,{modelValue:r.form.birth,"onUpdate:modelValue":e[5]||(e[5]=l=>r.form.birth=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(f,{label:"地址"},{default:a(()=>[t(u,{modelValue:r.form.addr,"onUpdate:modelValue":e[6]||(e[6]=l=>r.form.addr=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])],64)}}};export{ge as default};
