import{u as te,a as le}from"./usePagination-BlbGfASI.js";import{u as ae}from"./useCrud-k8ZUbDpW.js";import{_ as oe,r as b,z as re,s as v,h as f,k as se,p as ne,c as de,a as V,x as ue,d as e,w as a,j as n,e as s,t as w,v as ie,b as me,F as pe,o as x,g as p,E as k}from"./index-CXv7L5KJ.js";const ce={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},fe={class:"order-1 sm:order2 text-center"},ge={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 order-3"},_e={class:"overflow-auto"},be={__name:"OrderManagement",setup(ve){const{dialogWidth:A}=te(),h=b(),o=re({visible:!1,isEdit:!1,title:"",form:{createdAt:"",member:"",items:"",price:"",status:""}}),D={createdAt:[{required:!0,message:"請選擇下單日期",trigger:"blur"}],member:[{required:!0,message:"請輸入會員名稱",trigger:"blur"}],items:[{required:!0,message:"請輸入商品名稱",trigger:"blur"}],price:[{required:!0,message:"請輸入訂單金額",trigger:"blur"}],status:[{required:!0,message:"請選擇訂單狀態",trigger:"blur"}]},{loading:U,list:L,fetchData:O,handleAdd:N,handleEdit:S,handleDelete:q,submit:z}=ae({getApi:f.getOrderList,addApi:f.addOrder,updateApi:f.updateOrder,deleteApi:f.deleteOrder,formRef:h,dialog:o,defaultForm:{createdAt:v().format("YYYY-MM-DD"),member:"",items:"",price:0,status:""},getTitle:r=>r==="add"?"新增訂單":"編輯訂單"}),E=async(r,t)=>{try{await f.updateOrder(r,{status:t}),k.success("更改訂單狀態成功")}catch{k.error("更改訂單狀態失敗")}},T=r=>{switch(r){case"processing":return"primary";case"shipped":return"warning";case"completed":return"success";default:return""}},$=r=>{switch(r){case"processing":return"處理中";case"shipped":return"已出貨";case"completed":return"已完成";default:return"未知"}},j=b(v().format("YYYY-MM")),i=b(j.value),g=b(""),C=se(()=>L.value.filter(r=>{const t=!i.value||v(r.createdAt).format("YYYY-MM")===i.value,d=!g.value||r.orderNumber.toLowerCase().includes(g.value.toLowerCase());return t&&d})),{currentPage:B,pageSize:P,pagedList:F,handlePageChange:I}=le(C,8),R=(r,t,d)=>v(d).format("YYYY-MM-DD"),W=r=>"NT$ "+r.price.toLocaleString();return ne(()=>{O()}),(r,t)=>{const d=s("el-button"),M=s("el-date-picker"),Y=s("el-input"),u=s("el-table-column"),G=s("el-tag"),m=s("el-option"),y=s("el-select"),H=s("el-table"),J=s("el-pagination"),K=s("el-card"),c=s("el-form-item"),Q=s("el-input-number"),X=s("el-form"),Z=s("el-dialog"),ee=ie("loading");return x(),de(pe,null,[V("header",ce,[e(d,{onClick:n(N),type:"primary",class:"order-2 sm:order-1"},{default:a(()=>t[9]||(t[9]=[p("新增訂單")])),_:1},8,["onClick"]),V("h3",fe,w(i.value?i.value+" ":"全部")+"訂單",1),V("div",ge,[e(M,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value=l),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份"},null,8,["modelValue"]),e(Y,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),"prefix-icon":"search",placeholder:"請輸入訂單編號"},null,8,["modelValue"])])]),ue((x(),me(K,{"element-loading-text":"載入中，請稍候..."},{default:a(()=>[V("div",_e,[e(H,{data:n(F),class:"mb-4 min-w-[1000px]",stripe:""},{default:a(()=>[e(u,{prop:"orderNumber",label:"訂單編號","min-width":"120"}),e(u,{prop:"createdAt",label:"下單日期","min-width":"100",formatter:R}),e(u,{prop:"member",label:"會員名稱","min-width":"80"}),e(u,{prop:"items",label:"商品名稱","min-width":"180"}),e(u,{prop:"price",label:"訂單金額","min-width":"100",formatter:W}),e(u,{prop:"status",label:"狀態","min-width":"140"},{default:a(({row:l})=>[e(y,{modelValue:l.status,"onUpdate:modelValue":_=>l.status=_,onChange:_=>E(l.id,l.status),class:"status-select"},{prefix:a(()=>[e(G,{type:T(l.status)},{default:a(()=>[p(w($(l.status)),1)]),_:2},1032,["type"])]),default:a(()=>[e(m,{label:"處理中",value:"processing"}),e(m,{label:"已出貨",value:"shipped"}),e(m,{label:"已完成",value:"completed"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(u,{label:"操作","min-width":"150"},{default:a(({row:l})=>[e(d,{onClick:_=>n(S)(l),type:"primary"},{default:a(()=>t[10]||(t[10]=[p("編輯")])),_:2},1032,["onClick"]),e(d,{onClick:_=>n(q)(l.id),type:"danger"},{default:a(()=>t[11]||(t[11]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(J,{background:"",layout:"prev, pager, next","page-size":n(P),"current-page":n(B),total:C.value.length,onCurrentChange:n(I)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[ee,n(U)]]),e(Z,{modelValue:o.visible,"onUpdate:modelValue":t[8]||(t[8]=l=>o.visible=l),title:o.title,width:n(A)},{footer:a(()=>[e(d,{onClick:t[7]||(t[7]=l=>o.visible=!1)},{default:a(()=>t[12]||(t[12]=[p("取消")])),_:1}),e(d,{onClick:n(z),type:"primary"},{default:a(()=>t[13]||(t[13]=[p("確認")])),_:1},8,["onClick"])]),default:a(()=>[e(X,{model:o.form,rules:D,ref_key:"formRef",ref:h,"label-width":"80px","label-position":"right"},{default:a(()=>[e(c,{prop:"createdAt",label:"下單日期"},{default:a(()=>[e(M,{modelValue:o.form.createdAt,"onUpdate:modelValue":t[2]||(t[2]=l=>o.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"選擇日期"},null,8,["modelValue"])]),_:1}),e(c,{prop:"member",label:"會員名稱"},{default:a(()=>[e(Y,{modelValue:o.form.member,"onUpdate:modelValue":t[3]||(t[3]=l=>o.form.member=l)},null,8,["modelValue"])]),_:1}),e(c,{prop:"items",label:"商品名稱"},{default:a(()=>[e(Y,{modelValue:o.form.items,"onUpdate:modelValue":t[4]||(t[4]=l=>o.form.items=l)},null,8,["modelValue"])]),_:1}),e(c,{prop:"price",label:"訂單金額"},{default:a(()=>[e(Q,{modelValue:o.form.price,"onUpdate:modelValue":t[5]||(t[5]=l=>o.form.price=l)},null,8,["modelValue"])]),_:1}),e(c,{prop:"status",label:"訂單狀態"},{default:a(()=>[e(y,{modelValue:o.form.status,"onUpdate:modelValue":t[6]||(t[6]=l=>o.form.status=l),placeholder:"請選擇訂單狀態"},{default:a(()=>[e(m,{label:"處理中",value:"processing"}),e(m,{label:"已出貨",value:"shipped"}),e(m,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])],64)}}},Ce=oe(be,[["__scopeId","data-v-680e85c2"]]);export{Ce as default};
