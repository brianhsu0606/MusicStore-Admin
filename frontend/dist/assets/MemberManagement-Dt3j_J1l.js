import{u as Z,a as ee}from"./usePagination-Bvq1YqOg.js";import{u as te}from"./useCrud-BF1HUNL_.js";import{r as _,z as le,s as b,h as v,k as ae,p as oe,c as re,a as Y,x,d as t,w as a,j as d,e as n,t as k,v as ne,b as y,F as de,o as V,g as f}from"./index-Di3fm30Y.js";const me={class:"mb-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},ie={class:"order-1 sm:order2 text-center"},se={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 order-3"},ue={class:"overflow-auto"},_e={__name:"MemberManagement",setup(pe){const{dialogWidth:A}=Z(),h=_(),r=le({visible:!1,isEdit:!1,title:"",form:{createdAt:"",name:"",gender:"",birth:"",addr:""}}),U={createdAt:[{required:!0,message:"請選擇註冊日期",trigger:"blur"}],name:[{required:!0,message:"請輸入姓名",trigger:"blur"}],gender:[{required:!0,message:"請選擇性別",trigger:"blur"}]},{loading:L,dialogLoading:z,list:F,fetchData:j,handleAdd:B,handleEdit:E,handleDelete:q,submit:I}=te({getApi:v.getMemberList,addApi:v.addMember,updateApi:v.updateMember,deleteApi:v.deleteMember,formRef:h,dialog:r,defaultForm:{createdAt:b().format("YYYY-MM-DD"),name:"",gender:"",birth:"",addr:""},getTitle:m=>m==="add"?"新增會員":"編輯會員"}),N=m=>{const e=new Date,o=new Date(m);let u=e.getFullYear()-o.getFullYear();const p=e.getMonth()-o.getMonth();return m?((p<0||p===0&&e.getDate()<o.getDate())&&u--,u):"-"},P=_(b().format("YYYY-MM")),s=_(P.value),c=_(""),D=ae(()=>F.value.filter(m=>{const e=!s.value||b(m.createdAt).format("YYYY-MM")===s.value,o=!c.value||m.name.toLowerCase().includes(c.value.toLowerCase());return e&&o})),{currentPage:S,pageSize:$,pagedList:R,handlePageChange:T}=ee(D,8),w=(m,e,o)=>o?b(o).format("YYYY-MM-DD"):"-",W=(m,e,o)=>o||"-";return oe(()=>{j()}),(m,e)=>{const o=n("el-button"),u=n("el-date-picker"),p=n("el-input"),i=n("el-table-column"),G=n("el-table"),H=n("el-pagination"),J=n("el-card"),g=n("el-form-item"),M=n("el-radio"),K=n("el-radio-group"),O=n("el-form"),Q=n("el-dialog"),C=ne("loading");return V(),re(de,null,[Y("header",me,[t(o,{type:"primary",onClick:d(B),class:"order-2 sm:order-1"},{default:a(()=>e[9]||(e[9]=[f("新增會員")])),_:1},8,["onClick"]),Y("h3",ie,k(s.value?s.value+" ":"全部")+"新增會員",1),Y("div",se,[t(u,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),type:"month",format:"YYYY-MM","value-format":"YYYY-MM",size:"large",placeholder:"請選擇月份"},null,8,["modelValue"]),t(p,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value=l),"prefix-icon":"search",placeholder:"請輸入會員名稱"},null,8,["modelValue"])])]),x((V(),y(J,{"element-loading-text":"載入中，請稍候..."},{default:a(()=>[Y("div",ue,[t(G,{data:d(R),class:"mb-4 min-w-[940px]",stripe:""},{default:a(()=>[t(i,{prop:"memberId",label:"會員ID","min-width":"66"}),t(i,{prop:"createdAt",label:"註冊日期",formatter:w}),t(i,{prop:"name",label:"姓名"}),t(i,{prop:"gender",label:"性別","min-width":"60"}),t(i,{label:"年齡","min-width":"60"},{default:a(({row:l})=>[f(k(N(l.birth)),1)]),_:1}),t(i,{prop:"birth",label:"生日",formatter:w}),t(i,{prop:"addr",label:"地址",formatter:W}),t(i,{label:"操作","min-width":"100"},{default:a(({row:l})=>[t(o,{type:"primary",onClick:X=>d(E)(l)},{default:a(()=>e[10]||(e[10]=[f("編輯")])),_:2},1032,["onClick"]),t(o,{type:"danger",onClick:X=>d(q)(l.id)},{default:a(()=>e[11]||(e[11]=[f("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(H,{background:"",layout:"prev, pager, next","page-size":d($),"current-page":d(S),total:D.value.length,onCurrentChange:d(T)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})),[[C,d(L)]]),t(Q,{modelValue:r.visible,"onUpdate:modelValue":e[8]||(e[8]=l=>r.visible=l),title:r.title,width:d(A)},{footer:a(()=>[t(o,{onClick:e[7]||(e[7]=l=>r.visible=!1)},{default:a(()=>e[12]||(e[12]=[f("取消")])),_:1}),t(o,{onClick:d(I),type:"primary"},{default:a(()=>e[13]||(e[13]=[f("確認")])),_:1},8,["onClick"])]),default:a(()=>[x((V(),y(O,{model:r.form,rules:U,ref_key:"formRef",ref:h,"label-width":"80px","label-position":"right","element-loading-text":"載入中，請稍候..."},{default:a(()=>[t(g,{prop:"createdAt",label:"註冊日期"},{default:a(()=>[t(u,{modelValue:r.form.createdAt,"onUpdate:modelValue":e[2]||(e[2]=l=>r.form.createdAt=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(g,{prop:"name",label:"姓名"},{default:a(()=>[t(p,{modelValue:r.form.name,"onUpdate:modelValue":e[3]||(e[3]=l=>r.form.name=l)},null,8,["modelValue"])]),_:1}),t(g,{prop:"gender",label:"性別"},{default:a(()=>[t(K,{modelValue:r.form.gender,"onUpdate:modelValue":e[4]||(e[4]=l=>r.form.gender=l),placeholder:"請選擇性別"},{default:a(()=>[t(M,{label:"男",value:"男"}),t(M,{label:"女",value:"女"}),t(M,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"生日"},{default:a(()=>[t(u,{modelValue:r.form.birth,"onUpdate:modelValue":e[5]||(e[5]=l=>r.form.birth=l),"value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(g,{label:"地址"},{default:a(()=>[t(p,{modelValue:r.form.addr,"onUpdate:modelValue":e[6]||(e[6]=l=>r.form.addr=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[C,d(z)]])]),_:1},8,["modelValue","title","width"])],64)}}};export{_e as default};
