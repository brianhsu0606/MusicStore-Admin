import{r as d,E as n,C as w}from"./index-CXv7L5KJ.js";const A=({getApi:f,addApi:o,updateApi:v,deleteApi:h,formRef:r,dialog:t,defaultForm:m,getTitle:u})=>{const i=d(!1),s=d([]),l=(e,a="操作失敗")=>{n.error(typeof e=="string"?e:a)};return{loading:i,list:s,fetchData:async()=>{i.value=!0;try{s.value=await f()}catch(e){l(e,"資料載入失敗")}finally{i.value=!1}},handleAdd:()=>{var e;t.visible=!0,t.isEdit=!1,t.title=u("add"),Object.assign(t.form,{...m}),(e=r.value)==null||e.clearValidate()},handleEdit:e=>{var a;t.visible=!0,t.isEdit=!0,t.title=u("edit"),Object.assign(t.form,e),(a=r.value)==null||a.clearValidate()},handleDelete:async e=>{if(await w.confirm("確定要刪除嗎？","刪除確認",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{await h(e),s.value=s.value.filter(c=>c.id!==e),n.success("刪除成功")}catch(c){l(c,"刪除失敗")}},submit:async()=>{try{if(await r.value.validate(),t.isEdit){const e=await v(t.form.id,t.form),a=s.value.findIndex(c=>c.id===e.id);a!==-1&&s.value.splice(a,1,e),n.success("編輯成功")}else{const e=await o(t.form);s.value.unshift(e),s.value.sort((a,c)=>new Date(c.createdAt)-new Date(a.createdAt)),n.success("新增成功")}t.visible=!1}catch(e){const a=t.isEdit?"編輯失敗":"新增失敗";l(e,a)}}}};export{A as u};
