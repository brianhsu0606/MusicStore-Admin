import{u as Me,a as q}from"./usePagination-BKKSXSYw.js";import{u as E}from"./useCrud-BBKD2bFM.js";import{_ as De,r as D,z as Ae,s as m,h as b,k as d,p as ke,c as A,a as u,d as e,F as k,l as O,e as r,w as l,v as Ve,o as g,b as C,y as we,n as Le,t as y,x as W,j as n,g as h}from"./index-7Xg1wZ2g.js";const ze={class:"flex flex-col sm:flex-row justify-between gap-4 mb-4"},Pe={class:"flex flex-col sm:flex-row order-2 sm:order-1 gap-4"},Se={class:"flex gap-4 items-center"},Re={class:"flex justify-between items-center mb-2"},$e={class:"mb-2"},Ne={class:"overflow-auto"},Fe={class:"mb-2"},Te={class:"overflow-auto"},Ue={__name:"FinanceDashboard",setup(je){const{dialogWidth:G}=Me(),V=D(),s=Ae({visible:!1,isEdit:!1,title:"",form:{name:"",category:"",createdAt:"",price:0}}),I={name:[{required:!0,message:"請輸入成本名稱",trigger:"blur"}],category:[{required:!0,message:"請選擇成本分類",trigger:"blur"}],createdAt:[{required:!0,message:"請選擇成本日期",trigger:"blur"}],price:[{required:!0,message:"請輸入成本金額",trigger:"blur"}]},H=["租金/水電","人事成本","進貨成本","其他成本"],{loading:J,list:w,fetchData:K,handleAdd:Q,handleEdit:X,handleDelete:Z,submit:ee}=E({getApi:b.getCostList,addApi:b.addCost,updateApi:b.updateCost,deleteApi:b.deleteCost,formRef:V,dialog:s,defaultForm:{name:"",category:"",createdAt:m().format("YYYY-MM-DD"),price:0},getTitle:a=>a==="add"?"新增成本":"編輯成本"}),{loading:te,list:L,fetchData:ae}=E({getApi:b.getRevenueList}),z=d(()=>L.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value).reduce((a,t)=>a+t.price,0)),P=d(()=>w.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value).reduce((a,t)=>a+t.price,0)),le=d(()=>z.value-P.value),oe=D(m().format("YYYY-MM")),i=D(oe.value),x=d(()=>w.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value)),M=d(()=>L.value.filter(a=>m(a.createdAt).format("YYYY-MM")===i.value)),{currentPage:re,pageSize:ne,pagedList:se,handlePageChange:ie}=q(x,8,!1),{currentPage:ue,pageSize:de,pagedList:ce,handlePageChange:pe}=q(M,8,!1),me=d(()=>{const a={};return x.value.forEach(t=>{const p=t.category||"未分類";a[p]=(a[p]||0)+t.price}),Object.entries(a).map(([t,p])=>({name:t,value:p}))}),ge=d(()=>({title:{text:`${i.value} 成本佔比圖`},tooltip:{},legend:{top:"bottom"},series:[{name:"成本項目",type:"pie",radius:"50%",data:me.value}]})),S=d(()=>[...M.value].sort((a,t)=>new Date(a.createdAt)-new Date(t.createdAt))),fe=d(()=>({title:{text:`${i.value} 營業額趨勢圖`},tooltip:{},xAxis:{type:"category",data:S.value.map(a=>m(a.createdAt).format("YYYY-MM-DD")),axisLabel:{rotate:45}},yAxis:{type:"value"},series:[{name:"營業額",type:"line",data:S.value.map(a=>a.price)}]})),_e=d(()=>[{icon:"GoodsFilled",bg:"bg-blue-400",title:`${i.value} 成本：`,value:()=>"NT "+P.value.toLocaleString()},{icon:"Money",bg:"bg-green-400",title:`${i.value} 營業額：`,value:()=>"NT "+z.value.toLocaleString()},{icon:"SuccessFilled",bg:"bg-red-500",title:`${i.value} 淨利潤：`,value:()=>"NT "+le.value.toLocaleString()}]),R=(a,t,p)=>m(p).format("YYYY-MM-DD"),$=a=>"NT "+Number(a.price).toLocaleString();return ke(()=>{K(),ae()}),(a,t)=>{const p=r("el-icon"),f=r("el-card"),N=r("el-date-picker"),F=r("v-chart"),_=r("el-button"),c=r("el-table-column"),T=r("el-table"),U=r("el-pagination"),ve=r("el-input"),Y=r("el-form-item"),be=r("el-option"),he=r("el-select"),Ye=r("el-input-number"),Ce=r("el-form"),ye=r("el-dialog"),j=r("el-col"),xe=r("el-row"),B=Ve("loading");return g(),A(k,null,[u("header",ze,[u("div",Pe,[(g(!0),A(k,null,O(_e.value,(o,v)=>(g(),C(f,{key:v,class:"min-w-[300px]"},{default:l(()=>[u("div",Se,[e(p,{size:50,class:we(`${o.bg} rounded-lg p-1`)},{default:l(()=>[(g(),C(Le(o.icon)))]),_:2},1032,["class"]),u("div",null,[u("h3",null,y(o.title),1),u("p",null,y(o.value()),1)])])]),_:2},1024))),128))]),e(N,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),type:"month",size:"large",format:"YYYY-MM","value-format":"YYYY-MM",placeholder:"選擇月份",clearable:!1,style:{width:"200px",height:"42px","font-size":"18px"},class:"order-1 sm:order-2"},null,8,["modelValue"])]),e(xe,{gutter:20},{default:l(()=>[W((g(),C(j,{lg:24,xl:12,"element-loading-text":"載入中，請稍候..."},{default:l(()=>[e(f,{class:"mb-4"},{default:l(()=>[e(F,{option:ge.value,autoresize:"",style:{height:"400px"}},null,8,["option"])]),_:1}),e(f,{class:"mb-4"},{default:l(()=>[u("div",Re,[u("h3",$e,y(i.value)+" 成本資料",1),e(_,{onClick:n(Q),type:"primary"},{default:l(()=>t[7]||(t[7]=[h("新增成本")])),_:1},8,["onClick"])]),u("div",Ne,[e(T,{data:n(se),stripe:"",class:"mb-4 min-w-[800px]"},{default:l(()=>[e(c,{prop:"createdAt",label:"日期",formatter:R}),e(c,{prop:"name",label:"項目"}),e(c,{prop:"category",label:"分類"}),e(c,{prop:"price",label:"金額",formatter:$,sortable:""}),e(c,{label:"操作"},{default:l(({row:o})=>[e(_,{onClick:v=>n(X)(o),type:"primary"},{default:l(()=>t[8]||(t[8]=[h("編輯")])),_:2},1032,["onClick"]),e(_,{onClick:v=>n(Z)(o.id),type:"danger"},{default:l(()=>t[9]||(t[9]=[h("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(U,{background:"",layout:"prev, pager, next","page-size":n(ne),"current-page":n(re),total:x.value.length,onCurrentChange:n(ie)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1}),e(ye,{modelValue:s.visible,"onUpdate:modelValue":t[6]||(t[6]=o=>s.visible=o),title:s.title,width:n(G)},{footer:l(()=>[e(_,{onClick:t[5]||(t[5]=o=>s.visible=!1)},{default:l(()=>t[10]||(t[10]=[h("取消")])),_:1}),e(_,{onClick:n(ee),type:"primary"},{default:l(()=>t[11]||(t[11]=[h("確認")])),_:1},8,["onClick"])]),default:l(()=>[e(Ce,{model:s.form,rules:I,ref_key:"formRef",ref:V,"label-width":"80px","label-position":"right"},{default:l(()=>[e(Y,{prop:"name",label:"成本名稱"},{default:l(()=>[e(ve,{modelValue:s.form.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.name=o)},null,8,["modelValue"])]),_:1}),e(Y,{prop:"category",label:"成本分類"},{default:l(()=>[e(he,{modelValue:s.form.category,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.category=o),placeholder:"請選擇成本分類"},{default:l(()=>[(g(),A(k,null,O(H,(o,v)=>e(be,{key:v,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(Y,{prop:"createdAt",label:"日期"},{default:l(()=>[e(N,{modelValue:s.form.createdAt,"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.createdAt=o),"value-format":"YYYY-MM-DD",placeholder:"選擇日期"},null,8,["modelValue"])]),_:1}),e(Y,{prop:"price",label:"金額"},{default:l(()=>[e(Ye,{modelValue:s.form.price,"onUpdate:modelValue":t[4]||(t[4]=o=>s.form.price=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])]),_:1})),[[B,n(J)]]),W((g(),C(j,{lg:24,xl:12,"element-loading-text":"載入中，請稍候..."},{default:l(()=>[e(f,{class:"mb-4"},{default:l(()=>[e(F,{option:fe.value,autoresize:"",style:{height:"400px"}},null,8,["option"])]),_:1}),e(f,{class:"mb-4"},{default:l(()=>[u("h3",Fe,y(i.value)+" 營業額資料",1),u("div",Te,[e(T,{data:n(ce),stripe:"",class:"mb-4 min-w-[900px]"},{default:l(()=>[e(c,{prop:"createdAt",label:"日期",formatter:R}),e(c,{prop:"price",label:"營業額",formatter:$,sortable:""}),e(c,{prop:"note",label:"備註"}),e(c,{prop:"createdBy",label:"登錄者"})]),_:1},8,["data"])]),e(U,{background:"",layout:"prev, pager, next","page-size":n(de),"current-page":n(ue),total:M.value.length,onCurrentChange:n(pe)},null,8,["page-size","current-page","total","onCurrentChange"])]),_:1})]),_:1})),[[B,n(te)]])]),_:1})],64)}}},Oe=De(Ue,[["__scopeId","data-v-be4e58d9"]]);export{Oe as default};
